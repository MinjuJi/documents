# 다중행함수(그룹함수)
- 조회된 행들의 집합그룹에 적용되어 그룹당 하나의 결과를 생성하는 함수다.
  + 집합그룹이란
    * 테이블 전체 또는 그룹화된 테이블의 행들을 말한다.
    * 집합그룹의 예
      - 사원테이블전체 혹은 부서별 평균임금
      - 직종별 전체 급여
      - 관리자별 관리직원수
      - 입사년도별 입사한 사원수
      - 급여등급별 사원수
- 사용시 주의사항
  + 그룹함수는 where절에서 사용할 수 없다.
  + 그룹함수와 그룹함수가 아닌 표현식을 select절에 같이 적을 수 없다.
  + 그룹함수의 중첩은 한번만 허용된다.
  + group by 절에 등장한 표현식은 그룹함수와 같이 select절에 적을 수 있다.

## 그룹함수의 종류
- count(*)
  + 조회된 모든 행의 갯수를 반환한다.
- count(컬럼 혹은 표현식)
  + 조회된 행에서 지정된 컬럼의 값이 null이 아닌 행의 갯수를 반환한다.
- sum(컬럼 혹은 표현식)
  + 조회된 행에서 지정된 컬럼의 값의 합계를 반환한다.(null값은 무시된다.)
- avg(컬럼 혹은 표현식)
  + 조회된 행에서 지정된 컬럼의 값의 평균을 반환한다.(null값은 무시된다.)
- min(컬럼 혹은 표현식)
  + 조회된 행에서 지정된 컬럼의 값의 최소값을 반환한다.(null값은 무시된다.)
- max(컬럼 혹은 표현식)
  + 조회된 행에서 지정된 컬럼의 값의 최대값을 반환한다.(null값은 무시된다.)
- variance(컬럼 혹은 표현식)
  + 조회된 행에서 지정된 컬럼의 값의 분산을 반환한다.(null값은 무시된다.)
- stddev(컬럼 혹은 표현식)
  + 조회된 행에서 지정된 컬럼의 값의 표준편차를 반환한다.(null값은 무시된다.)

## 테이블의 행을 그룹화하기
- group by 절을 사용해서 지정된 컬럼의 값이 같은 값을 가지는 행끼리 그룹화할 수 있다.
- group by절의 작성 규칙
```sql
  select 컬럼혹은표현식, 그룹함수(), 그룹함수()
  from 테이블명
  [where 조건식]
  [group by 컬럼혹은표현식]
  [order by 컬럼명]
```
- group by절은 행 그룹화 기준을 결정하는 값을 가진 컬럼을 지정한다.
- group by절에 지정한 컬럼은 select절에서 그룹함수와 같이 사용할 수 있다.
- select 절에서 사용된 그룹함수는 group by로 그룹화된 각각의 그룹마다 실행된다.

## 그룹함수 실행결과를 필터링하기
- having절은 group by 절을 사용해서 행을 그룹화하고, 각 그룹에 그룹함수를 실행한 결과를 필터링할 때 사용한다.
  * 일반적으로 행을 필터링할 때는 where절을 사용한다.
- where과 having
  + where
    * 행을 필터링한다.
    * 그룹함수를 조건식에 사용할 수 없다.
  + having
    * 그룹화된 그룹에 그룹함수 적용한 후에 계산된 결과로 필터링을 한다.
    * 그룹함수를 조건식에 사용할 수 있다.
- having절의 작성규칙
```sql
  select column, 그룹함수
  from table
  [where  조건식]
  [group by 컬럼혹은표현식]
  [having 그룹함수적용결과를 필터링하는 조건식]
  [order by 컬럼]
```

```sql
  -- 소속부서별로 사원수를 집계했을 때, 사원수가 5명 미만인 부서의 아이디와 사원수를 조회하기
  select department_id, count(*)
  from employees 
  group by department_id
  having count(*) < 5
```
