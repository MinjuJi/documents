# 스프링 시큐리티(Spring Security)
- 스프링 시큐리티는 스프링 기반의 애플리케이션의 보안(인증과 권한관리, 인가 등)을 담당하는 프레임워크다.
- 인증(Authentication)과 인가(Authorization)를  담당하는 프레임워크다.
- 스프링 시큐리티는 서블릿 필터(Filter)와 이들로 구성된 필터체인으로 보안과 관련된 처리를 수행한다.

## 스프링 시큐리티의 주요 용어
- 접근 주체(Principal) : 보호된 리소스에 접근하는 대상(사용자)
- 인증(Authentication) : 보호된 리소스에 접근하는 대상이 누구인지, 애플리케이션의 작업을 수행해도 되는 주체인지 확인하는 과정
  - 예시) Form 기반 로그인
- 인가(Authorization) : 해당 리소스에 대한 접근 가능한 권한을 가지고 있는지 확인하는 과정(인증과정 이후에 수행한다.)
- 권한 : 어떠한 리소스에 대한 접근 제한, 모든 리소스는 접근 제어 권한이 걸려있으며, 인가과정에서 해당 리소스에 대해 제한된 최소한의 권한을 가졌는지 확인한다.

## 스프링 시큐리티의 사용자 인증 프로세스
<kbd>![alt for문의 실행흐름](springsecurity-flow.PNG)</kbd>
- 1번
  - 사용자가 사용자이름과 비밀번호를 서버로 보낸다.
- 2번
  - AuthenticationFilter(UsernamePasswordAuthenticationFilter 구현객체가 사용됨)가 HttpServletRequest객체에서 사용자정보를 가로챈다.
  - Authenction객체(UsernamePasswordAuthenticationToken 구현객체가 사용됨)을 생성하고, 사용자 정보를 저장한다.
- 3번
  - AuthenticationFilter가 인증을 담당하는 AuthenticationManager(인증관리자)에게 Authentication객체를 전달한다.
- 4번 
  - 인증관리자(AuthenticationManager)는 내부적으로 AuthenticationProvider(DaoAuthenticationProvider 구현객체가 실제로 사용됨)에게 인증처리를 위임한다.
- 5번 
  - AuthenticationProvider은 데이터베이스에 저장된 사용자 정보를 조회하기 위해서 UserDetailsService를 이용한다.
  - 개발자는 UserDetailsService 인터페이스의 loadUserByUsername(String username) 메소드를 재정의해서 데이터베이스에 저장된 사용자 정보를 반환한다.
- 6번
  - UserDetailsService는 데이터베이스에서 사용자정보를 조회하면 UserDetails 인터페이스를 구현한 객체에 사용자 정보를 저장해서 반환한다.
  - UserDetails는 사용자정보, 비밀번호, 권한정보, 계정만료 정보등을 제공하는 객체다.
- 7번 
 - AuthenticationProvider은 UserDetailsService가 제공하는 사용자정보와 사용자가 로그인폼에서 입력한 사용자 정보를 비교해서 사용자 인증 작업을 수행한다.
- 8번
 - 인증작업이 실패하면 AuthenticationException 예외를 반한하여 UsernamePasswordAuthenticationFilter로 돌아가사 예외처리를 수행한다.
 - 인증작업이 성공하면 Authentication객체에 사용자정보와 권한정보를 담아서 AuthenticationManager에게 반환한다.
- 9번 
  - 인증이 완료되면 AuthenctionManager는 AuthenticationProvider 로부터 반환받은 인증객체(인증결과 유저 + 유저권한정보)를 SecurityContext객체에 저장한다.
- 10번
  - SecurityContext는 Session에도 저장되기 때문에 전역적으로 SecurityContext를 참조할 수 있다.




