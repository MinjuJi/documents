# 스프링 시큐리티 규현하기
- 스프링부트, 스프링시큐리티, 스프링웹MVC, JSP를 이용한 스프리시큐리티 예제 구현하기 입니다.
## 프로젝트 생성하기
- Spring Starter Project로 프로젝트 생성하기
  - 프로젝트명 : spring-security
  - Type : Maven Project
  - Packing : War
  - Java Version : 11
  - Language : Java
  - Group : com.example
  - Artifact : spring-security
  - Version : 0.0.1-SNAPSHOT
  - Description : Spring security Demo Project
  - Package : com.example
- 프로젝트 의존성 추가하기
  - Spring Web, Spring Security
  - Oracle Driver, MyBatis Framework
  - Lombok, Spring Boot DevTools
- pom.xml 파일 수정하기
```xml
  <dependencies>
    <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-security</artifactId>
    </dependency>
    <!-- 스프링 시큐리티 태그라이브러리 의존성 추가 -->
    <dependency>
      <groupId>org.springframework.security</groupId>
      <artifactId>spring-security-taglibs</artifactId>
    </dependency>		
    <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    <dependency>
      <groupId>com.oracle.database.jdbc</groupId>
      <artifactId>ojdbc8</artifactId>
      <scope>runtime</scope>
    </dependency>
    <dependency>
      <groupId>org.mybatis.spring.boot</groupId>
      <artifactId>mybatis-spring-boot-starter</artifactId>
      <version>2.2.2</version>
    </dependency>
    <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-devtools</artifactId>
      <scope>runtime</scope>
      <optional>true</optional>
    </dependency>
    <dependency>
      <groupId>org.projectlombok</groupId>
      <artifactId>lombok</artifactId>
      <optional>true</optional>
    </dependency>
    <!-- 스프링부트가 제공하는 Tomcat 사용하지 않도록 주석처리 -->
    <!--
    <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-tomcat</artifactId>
      <scope>provided</scope>
    </dependency>
    -->
    <!-- JSP를 지원하는 Tomcat과 JSTL 태그 라이브러리 의존성 추가 -->
    <dependency>
      <groupId>org.apache.tomcat.embed</groupId>
      <artifactId>tomcat-embed-jasper</artifactId>
    </dependency>
    <dependency>
      <groupId>javax.servlet</groupId>
      <artifactId>jstl</artifactId>
    </dependency>
    <!-- 이하 생략 -->
</dependencies>
```
- application.properties 파일 수정하기
```properties
  # logging level
  logging.level.root=INFO
  # mybatis mapper logging level
  logging.level.com.example.mapper=TRACE

  # webserver port number
  server.port=80

  # connection pool
  spring.datasource.driver-class-name=oracle.jdbc.OracleDriver
  spring.datasource.url=jdbc:oracle:thin:@localhost:1521:xe
  spring.datasource.username=hr
  spring.datasource.password=zxcv1234
  
  # jsp page 
  spring.mvc.view.prefix=/WEB-INF/views/
  spring.mvc.view.suffix=.jsp

  # static resource(css, js, images)
  spring.mvc.static-path-pattern=/resources/**
  spring.web.resources.static-locations=/resources/
```

## 데이터베이스 엑세스 구현하기
- 테이블 생성하기
```sql
  CREATE TABLE TB_SAMPLE_SECURITY_USERS (
    USER_NO NUMBER(6) PRIMARY KEY,
    USER_NAME VARCHAR2(100) NOT NULL,
    USER_EMAIL VARCHAR2(255) NOT NULL UNIQUE,
    USER_PASSWORD VARCHAR2(255) NOT NULL
  );
```
- mybatis-config.xml 파일 생성하기
  - src/main/resources/mybatis/mybatis-config.xml 파일 생성
```xml
  <?xml version="1.0" encoding="UTF-8"?>
  <!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-config.dtd" >
  <configuration>
    <settings>
      <setting name="logImpl" value="LOG4J2"/>
      <setting name="jdbcTypeForNull" value="NULL"/>
    </settings>
  </configuration>
```
- VO 객체 정의하기
```java
  package com.example.vo;

  @Getter
  @Setter
  public class User {
    private int no;
    private String name;
    private String email;
    private String password;
  }
```
- Mapper 인터페이스 정의하기
```java
  package com.example.mapper;

  import org.apache.ibatis.annotations.Mapper;
  import com.example.vo.User;

  @Mapper
  public interface UserMapper {
    void insert(User user);
    User getUserByNo(int no);
    User getUserByEmail(String email;
  }
```
- Mapper 파일 정의하기
  - src/main/resources/mybatis/mappers/UserMapper.xml 파일을 생성한다.
```xml
  <?xml version="1.0" encoding="UTF-8"?>
  <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
  <mapper namespace="com.example.mapper.UserMapper">

    <insert id="insert" parameterType="com.example.vo.User">
      insert into tb_sample_security_users (user_no, user_email, user_password, user_name)
      values (sample_users_seq.nextval, #{eamil}, #{password}, #{name})
    </insert>

    <select id="getUserByEmail" parameterType="string" resultType="com.example.vo.User">
      select
        user_no no,
        user_email email,
        user_password password,
        user_name name
      from
        tb_sample_security_users
      where
        user_email = #{value}
    </select>

    <select id="getUserByNo" parameterType="int" resultType="com.example.vo.User">
      select
        user_no no,
        user_email email,
        user_password password,
        user_name name
      from
        tb_sample_security_users
      where
        user_no = #{value}
    </select>
  </mapper>
```
- application.properties 파일 수정하기
```properties
  # mybatis 
  mybatis.config-location=classpath:/mybatis/mybatis-config.xml
  mybatis.mapper-locations=mybatis/mappers/*.xml
```
